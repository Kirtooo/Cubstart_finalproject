<!DOCTYPE html>
<html>
  <head>
    <title>SmartCards</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/passport/0.4.1/passport.min.js"></script>
    <script src="/flashcards.js"></script>
    <link rel="stylesheet" type="text/css" href="/styles.css">
  </head>
  <body>
    <h1>Welcome to SmartCards!</h1>
    <div id="login-container">
      <button id="login-button" onclick="window.location.href='/auth/google'">Sign in with Google</button>
    </div>
    <div id="content-container" style="display: none;">
      <h2>Flashcard Sets</h2>
      <ul id="set-list"></ul>
      <form id="create-set-form">
        <input type="text" id="set-name-input" placeholder="Enter set name" required>
        <input type="submit" value="Create set">
      </form>
      <h2>Study</h2>
      <div id="study-container" style="display: none;">
        <h3 id="study-set-name"></h3>
        <div id="card-container"></div>
        <button id="prev-card-button" style="display: none;">Previous</button>
        <button id="next-card-button">Next</button>
      </div>
    </div>
    <script>
      // On document load, check if the user is logged in
      $(document).ready(function() {
        $.get('/auth/check', function(data) {
          if (data.loggedIn) {
            // User is logged in, show content container
            $('#login-container').hide();
            $('#content-container').show();
            // Load flashcard sets
            loadSets();
          } else {
            // User is not logged in, hide content container
            $('#login-container').show();
            $('#content-container').hide();
          }
        });
      });
      // Handle flashcard set creation
      $('#create-set-form').submit(function(event) {
        event.preventDefault();
        const setName = $('#set-name-input').val();
        $.post('/flashcards/create', { name: setName }, function(data) {
          // Handle the response from the server
          if (data.success) {
            $('#set-list').append($('<li>').text(setName).attr('data-set-id', data.setId));
            $('#set-name-input').val('');
          }
        });
      });
      // Handle flashcard set selection
      $('#set-list').on('click', 'li', function() {
        const setId = $(this).attr('data-set-id');
        const setName = $(this).text();
        $.get(`/flashcards/set/${setId}`, function(data) {
          // Handle the response from the server
          if (data.success) {
            // Display study container and load cards
            $('#study-container').show();
            $('#study-set-name').text(setName);
            loadCards(data.cards);
          }
        });
      });
      // Handle card navigation
      $('#next-card-button').click(function() {
        const currentCardIndex = parseInt($('#card-container').attr('data-current-card-index'));
        const nextCardIndex = currentCardIndex + 1;
        const numCards = parseInt($('#card-container').attr('data-num-cards'));
        if (nextCardIndex >= numCards) {
          // No more cards,
          alert('You have reached the end of the flashcards!');
          return;
        }
        $('#card-container').attr('data-current-card-index', nextCardIndex);
        const card = $(`#card-${nextCardIndex}`);
        card.show();
        card.siblings().hide();
        if (nextCardIndex === numCards - 1) {
          $('#next-card-button').hide();
        }
        if (nextCardIndex > 0) {
          $('#prev-card-button').show();
        }
      });
      $('#prev-card-button').click(function() {
        const currentCardIndex = parseInt($('#card-container').attr('data-current-card-index'));
        const prevCardIndex = currentCardIndex - 1;
        if (prevCardIndex < 0) {
          // Already at the beginning of the flashcards
          return;
        }
        $('#card-container').attr('data-current-card-index', prevCardIndex);
        const card = $(`#card-${prevCardIndex}`);
        card.show();
        card.siblings().hide();
        if (prevCardIndex === 0) {
          $('#prev-card-button').hide();
        }
        if (prevCardIndex < numCards - 1) {
          $('#next-card-button').show();
        }
      });
    </script>
  </body>
</html>
